<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:hftl="http://hftl.org" xmlns:hf="http://xmlns.jcp.org/jsf/composite/tags" xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
    xmlns:s="http://jboss.org/seam/faces" template="/layout/template.xhtml">

    <ui:define name="metadata">
        <f:metadata>
            <f:event type="preRenderView" listener="#{customEntityTemplateBean.preRenderView}" />
        </f:metadata>
    </ui:define>
    <ui:define name="body">

        <h:form id="crumbmenuForm">
            <p:breadCrumb homeDisplay="text" id="crumbmenu">
                <p:menuitem value="#{messages['menu.admin']}" disabled="true" />
                <p:menuitem outcome="menuConfiguration" value="#{messages['menu.menuConfiguration']}" />
            </p:breadCrumb>
        </h:form>

        <hftl:decorateFormPanel formId="searchPanel" label="#{messages['menu.menuConfiguration']}">
            <ui:define name="fields">
                <hftl:decorateFormField fieldId="entityName" label="#{messages['customizedEntities.entityName']}">
                    <p:inputText id="entityName" value="#{customEntityTemplateBean.filters['entityName']}" />
            </hftl:decorateFormField>
            </ui:define>

            <ui:define name="buttons">
                <p:commandButton id="buttonSearch" value="#{messages['commons.search']}" ajax="true" update="searchResults" />

                <p:commandButton value="#{messages['commons.clean']}" process="@this" update="@form" action="#{customEntityTemplateBean.clean}">
                    <f:actionListener type="org.omnifaces.eventlistener.ResetInputAjaxActionListener" />
                </p:commandButton>
                <p:button id="buttonNew" value="#{messages['commons.new']}" outcome="customEntityDetail"
                          rendered="#{currentUser.hasRole('administrationManagement')}">
                    <f:param name="cid" value="#{javax.enterprise.context.conversation.id}" />
                    <f:param name="edit" value="true" />
                </p:button>
            </ui:define>
        </hftl:decorateFormPanel>

        <h:form prependId="false">
            <p:panel width="100">
                <p:dataTable id="searchResults" value="#{customEntityTemplateBean.customEntityTemplates}"
                             var="cetEntity"
                             paginator="true" rows="30" resizableColumns="true"
                             paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}" rowsPerPageTemplate="30,50"
                             lazy="true" styleClass="custom-grid" rowIndexVar="rowIndex">
                    <p:column headerText="#{messages['customEntityTemplate.entityName']}" value="#{customEntityTemplateBean.entity.superTemplate}" >
                        <h:link outcome="customEntities" value="#{cetEntity.code}">
                            <f:param name="cet" value="#{cetEntity.code}"></f:param>
                            <f:param name="cid" value="#{javax.enterprise.context.conversation.id}" />
                        </h:link>
                    </p:column>
                    <hftl:actionsColumn renderDuplicateLink="true" permission="#{currentUser.hasRole('administrationManagement')}" />
                </p:dataTable>
            </p:panel>
        </h:form>
    </ui:define>
</ui:composition>
