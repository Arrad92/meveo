<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:hftl="http://hftl.org" xmlns:hf="http://xmlns.jcp.org/jsf/composite/tags" xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui" xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:s="http://jboss.org/seam/faces" template="/layout/template.xhtml">

    <o:importConstants type="org.meveo.model.technicalservice.endpoint.EndpointHttpMethod" />
    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="objectId" value="#{endpointBean.objectId}" />
        </f:metadata>
    </ui:define>

    <ui:define name="body">
        <h:form id="crumbmenuForm">
            <p:breadCrumb homeDisplay="text" id="crumbmenu">
                <p:menuitem value="#{messages['menu.admin']}" disabled="true" />
                <p:menuitem outcome="endpoint" value="#{messages['enpoint.endpoint']}" />
                <p:menuitem value="#{endpointBean.entity.code}" />
            </p:breadCrumb>
        </h:form>
        <hftl:entityPopup id="searchFuncionPopup"
                          header="#{messages['endpoint.search.endpoint.service']}"
                          backingBean="#{functionBean}"
                          searchField1Label="#{messages['BusinessEntity.code']}"
                          searchField1="code" column1Label="#{messages['BusinessEntity.code']}"
                          column1="code" selection="#{endpointBean.entity.service}"
                          column2Label="#{messages['BusinessEntity.description']}"
                          column2="description"
                          column3="class"
                          column3Child = "simpleName"
                          column3Label="Type"
                          updateField=":endpointForm:serviceId :endpointForm:serviceId_text :endpointForm:technicalServiceParametersId :endpointForm:pathParametersId">
        </hftl:entityPopup>
        <hftl:formPanel formId = "endpointForm" label="#{messages['endpoint.panel']}" backingBean="#{endpointBean}">
            <h:panelGrid columns="5">
                <hftl:formField label="#{messages['endpoint.name']}" field="code" required="true" validateUnique="true"/>
                <hftl:formField id="serviceId" label="#{messages['endpoint.code']}" field="service" valueLabelField="code" required="true" popup="true"
                                popupId="searchFuncionPopup" allowEdit="true" displayOneLine="false" componentWidth="100" />
                <hftl:formField label="#{messages['endpoint.description']}" field="description" />
                <hftl:decorateFormField field = "method" fieldId="method" componentWidth="100" label="#{messages['endpoint.method']}">
                    <p:selectOneMenu id="method" value="#{endpointBean.entity.method}" style="width:150px;">
                        <f:selectItem itemLabel="#{messages['endpoint.selectMethod']}" itemValue="" noSelectionOption="true" />
                        <f:selectItem itemLabel="#{messages['endpoint.GET']}" itemValue="GET" />
                        <f:selectItem itemLabel="#{messages['endpoint.POST']}" itemValue="POST" />
                    </p:selectOneMenu>
                </hftl:decorateFormField>
                <hftl:formField label="#{messages['enpoint.synchronous']}" field="synchronous" />
            </h:panelGrid>
            <hftl:decorateFormField field ="pathParameters" fieldId="technicalServiceParametersId" componentWidth="100" label="#{messages['endpoint.technicalServiceParameters']}">
                <p:dataTable id="technicalServiceParametersId" var="parameterMapping" value="#{endpointBean.entity.service.inputs}" editable="false">
                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="#{messages['endpoint.technicalServiceParameters.name']}" />
                        </f:facet>
                        <f:facet name="output"><h:outputText value="#{parameterMapping.name}"/></f:facet>
                    </p:column>
                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="#{messages['endpoint.technicalServiceParameters.type']}" />
                        </f:facet>
                        <f:facet name="output"><h:outputText value="#{parameterMapping.type}"/></f:facet>
                    </p:column>
                    <p:column>
                        <f:facet name="header">
                            <h:outputText value="#{messages['endpoint.technicalServiceParameters.description']}" />
                        </f:facet>
                        <f:facet name="output"><h:outputText value="#{parameterMapping.description}"/></f:facet>
                    </p:column>
                </p:dataTable>
            </hftl:decorateFormField>
            <h:panelGrid columns="2">
                <hftl:formField label="#{messages['endpoint.pathParameter']}" field="pathParameters" id="pathParametersId"
                                listType="pickUpList" valueLabelField="endpointParameter.parameter" valueLabelField2="endpointParameter.parameter"
                                dualListModel="#{endpointBean.dualListModel}" newLine="true" updateField=":parametersMappingId"/>
                <hftl:decorateFormField field ="parametersMapping" fieldId="parametersMappingId" componentWidth="100" label="#{messages['endpoint.parameters.mapping']}">
                    <p:dataTable id="parametersMappingId" var="parameterMapping" value="#{endpointBean.parameterMappings}" editable="true" editMode="cell">
                        <p:ajax event="cellEdit" listener="#{endpointBean.onCellEdit}"/>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="#{messages['endpoint.parameters.mapping.service']}" />
                            </f:facet>
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{parameterMapping.parameterName}"/></f:facet>
                                <f:facet name="input"><p:inputText id="parameter" value="#{parameterMapping.endpointParameter.parameter}" style="width:100%"/></f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="#{messages['endpoint.parameters.mapping.expose']}" />
                            </f:facet>
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{parameterMapping.parameterName}"/></f:facet>
                                <f:facet name="input"><p:inputText id="parameterName" value="#{parameterMapping.parameterName}" style="width:100%"/></f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="#{messages['endpoint.parameters.mapping.default']}" />
                            </f:facet>
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{parameterMapping.parameterName}"/></f:facet>
                                <f:facet name="input"><p:inputText id="defaultValue" value="#{parameterMapping.defaultValue}" style="width:100%"/></f:facet>
                            </p:cellEditor>
                        </p:column>
                    </p:dataTable>
                </hftl:decorateFormField>
            </h:panelGrid>
            <hftl:decorateFormField field ="endpointUrl" fieldId="endpointUrlId" label="#{messages['endpoint.accessUrl']}">
                <p:inputText id="endpointUrlId" value="#{endpointBean.entity.endpointUrl}" size="100" maxlength="100"  readonly="true" />
            </hftl:decorateFormField>
        </hftl:formPanel>
    </ui:define>

</ui:composition>