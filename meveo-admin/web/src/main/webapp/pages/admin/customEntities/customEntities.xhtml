<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:hftl="http://hftl.org"
	template="/layout/template.xhtml" xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions">

	<ui:define name="metadata">
		<f:metadata>
			<f:event type="preRenderView"
				listener="#{customEntityInstanceListBean.preRenderView}" />
			<f:viewParam name="cet"
				value="#{customEntityInstanceListBean.customEntityTemplateCode}" />
			<f:viewParam name="cet"
				value="#{customEntityInstanceBean.customEntityTemplateCode}" />
			<o:viewAction action="#{customEntityInstanceListBean.initialize()}" />
		</f:metadata>
	</ui:define>

	<ui:define name="body">

		<h:form id="crumbmenuForm">
			<p:breadCrumb homeDisplay="text" id="crumbmenu">
				<p:menuitem value="#{messages['menu.catalog']}" disabled="true" />
				<p:menuitem outcome="customEntities"
					value="#{customEntityInstanceBean.customEntityTemplateCode}" />
			</p:breadCrumb>
		</h:form>

		<hftl:searchPanel
			label="#{customEntityInstanceListBean.customEntityTemplate.name} #{messages['customEntityInstance.search']}"
			backingBean="#{customEntityInstanceListBean}" renderNewButton="false">
			<hftl:searchField label="#{messages['BusinessEntity.code']}"
				field="code" />
			<hftl:searchField label="#{messages['BusinessEntity.description']}"
				field="description" />
			<hftl:searchField label="#{messages['enableEntity.disabled']}"
				field="disabled" />
			<ui:define name="buttons">
				<p:panel id="customButtons" styleClass="search-panel-actions" style="padding-left: 0px;">
					<p:button value="#{messages['commons.new']}"
						outcome="#{customEntityInstanceListBean.newViewName}"
						rendered="#{customEntityInstanceListBean.repository != null}">
						<f:param name="cid"
							value="#{javax.enterprise.context.conversation.id}" />
						<f:param name="edit" value="true" />
						<f:param name="uuid" value="#{entity.uuid}" />
						<f:param name="cet"
							value="#{customEntityInstanceListBean.customEntityTemplateCode}" />
						<f:param name="repo"
							value="#{customEntityInstanceListBean.repository.code}" />
					</p:button>
				</p:panel>
			</ui:define>
		</hftl:searchPanel>

		<h:form>
			<p:panel styleClass="form-panel">
				<hftl:decorateFormField fieldId="repository"
					label="#{messages['binary.repository']}">
					<p:selectOneMenu id="repository"
						value="#{customEntityInstanceListBean.repository}">
						<f:selectItem itemLabel="" itemValue="#{null}" />
						<f:selectItems var="e" itemValue="#{e}" itemLabel="#{e.code}"
							value="#{customEntityInstanceListBean.listRepositories()}"></f:selectItems>
						<hftl:objectConverter />
						<f:attribute name="cid"
							value="#{javax.enterprise.context.conversation.id}" />
						<p:ajax update="contentBody :#{p:component('customButtons')}"
							listener="#{customEntityInstanceListBean.handleRepositoryChangeEvent}">
						</p:ajax>
					</p:selectOneMenu>
				</hftl:decorateFormField>
			</p:panel>
		</h:form>

		<p:outputPanel id="contentBody">
			<p:panel width="100" rendered="#{customEntityInstanceListBean.repository != null}">
				
			<h:form prependId="false">
				<p:dataTable id="results_panel"
					value="#{customEntityInstanceListBean.nativeDataModel}"
					var="entity" 
					lazy="true" 
					widgetVar="ctTable"
					paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
					currentPageReportTemplate="{startRecord} - {endRecord} of {totalRecords}"
					paginator="true" 
					rows="10" 
					rowsPerPageTemplate="10,15,20,50"
					resizableColumns="true" 
					styleClass="custom-grid" 
					reflow="true"
					editable="false" 
					rowSelectMode="checkbox"
					selection="#{customEntityInstanceListBean.selectedValues}"
					rowIndexVar="rowIdx">

					<p:column id="multiSelect" selectionMode="multiple" width="4%"
						exportable="false" toggleable="false" selectRow="false" />

					<p:column headerText="uuid" selectRow="false">
						<h:outputText value="#{entity['uuid']}" />

					</p:column>

					<p:column headerText="#{messages['BusinessEntity.code']}">
						<h:outputText value="#{entity['code']}" styleClass="field-value">
						</h:outputText>
					</p:column>

					<p:column headerText="#{messages['BusinessEntity.description']}">
						<h:outputText value="#{entity['description']}"
							styleClass="field-value">
						</h:outputText>
					</p:column>

					<p:column headerText="#{messages['commons.actions']}"
						exportable="false" selectRow="false">
						<p:tooltip for="editlink" value="#{messages['commons.edit']}"
							showEffect="slide" hideEffect="slide" />
						<p:button id="editlink"
							outcome="#{customEntityInstanceListBean.getEditViewName()}"
							icon="ui-icon-document">
							<f:param name="edit" value="true" />
							<f:param name="cid"
								value="#{javax.enterprise.context.conversation.id}" />
							<f:param name="uuid" value="#{entity.uuid}" />
							<f:param name="cet"
								value="#{customEntityInstanceListBean.customEntityTemplateCode}" />
							<f:param name="repo"
								value="#{customEntityInstanceListBean.repository.code}" />
						</p:button>

						<p:remoteCommand id="remoteDeleteButton"
							actionListener="#{customEntityInstanceBean.delete}"
							name="doDelete" update="contentBody" />
						<p:tooltip for="deletelink" value="#{messages['commons.delete']}"
							showEffect="slide" hideEffect="slide" />
						<p:commandButton id="deletelink" immediate="true"
							icon="ui-icon-trash" oncomplete="doDelete()">
							<f:param name="cid" value="#{javax.enterprise.context.conversation.id}" />
							<f:param name="cet" value="#{customEntityInstanceListBean.customEntityTemplate.code}" />
							<f:setPropertyActionListener
								target="#{customEntityInstanceBean.uuid}" value="#{entity.uuid}" />
							<f:setPropertyActionListener
								target="#{customEntityInstanceBean.repositoryCode}"
								value="#{customEntityInstanceListBean.repository.code}" />
							<f:setPropertyActionListener
								target="#{customEntityInstanceBean.customEntityTemplateCode}"
								value="#{customEntityInstanceListBean.customEntityTemplate.code}" />
							<p:confirm header="#{messages['commons.confirmationHeader']}"
								message="#{messages['commons.confirmDelete']}"
								icon="ui-icon-alert" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</h:form>
				
			</p:panel>
			
		</p:outputPanel>
		

	</ui:define>

</ui:composition>
